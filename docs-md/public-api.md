> ☝ Помимо интеграции по API вы также можете [установить готовый виджет на сайт](https://clicker.youtrack.cloud/articles/ISDEV-A-25/%D0%98%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%86%D0%B8%D1%8F-%D0%BF%D0%BE-%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%B2%D0%B8%D0%B4%D0%B6%D0%B5%D1%82%D0%B0-Clicker)

<br>

# Создание заказа

1. API endpoint: https://api.clicker.one/v1/orders
2. API принимает POST запросы от внешней системы. В запросе система ожидает получить заголовок: Content-Type: application/json.
3. Система отвечает HTTP кодом и JSON объектом.
4. В случае успешного запроса поле "status" в ответе будет иметь значение "OK". В противном случае - "error".

### Описание параметров тела запроса (JSON массив)

| Название               | Тип                          | Описание                                                                                                                                                                    | Обязательный |
| ---------------------- | ---------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ |
| shopId                 | String                       | Идентификатор магазина в системе Clicker                                                                                                                                    | Yes          |
| apiKey                 | String                       | API ключ клиента                                                                                                                                                            | Yes          |
| city                   | String                       | Город создания заказа. См. <a href="https://clicker.youtrack.cloud/articles/ISDEV-A-25/Instruktsiya-po-integratsii-vidzheta-Clicker#51-Goroda">список доступных городов</a> | Yes          |
| clientsFullName        | String                       | ФИО клиента                                                                                                                                                                 | Yes          |
| clientsAddress         | String                       | Адрес доставки и оказания услуг                                                                                                                                             | Yes          |
| clientsPhone           | String                       | Мобильный телефон клиента в формате +7... 7... 8... или 9... только цифры, без проблелов, дефисов, скобок и других разделителей                                             | Yes          |
| includedServicesCustom | JSON Array                   | Массив услуг в заказе (см описание ниже) (одно из полей includedServicesCustom или includedServicesIds может быть пустым)                                                   | Yes          |
| includedServicesIds    | JSON Array                   | Массив id услуг из справочника (одно из полей includedServicesCustom или includedServicesIds может быть пустым)                                                             | Yes          |
| comment                | String                       | Примечание к заказу                                                                                                                                                         | No           |
| type                   | Enum ("new", "consultation") | new: новый заказ (дефолтное значение) consultation: нужна консультация мастера (это не заказ на монтаж, а заказ на звонок мастера клиенту по техническим вопросам)          | No           |
| timeOfVisitFrom        | 2020-01-10 15:00:00          | Дата и время визита мастера (начало промежутка). Местное время по городу заказа                                                                                             | No           |
| timeOfVisitTo          | 2020-01-10 15:00:00          | Дата и время визита мастера (конец промежутка). Местное время по городу заказа                                                                                              | No           |
| timeOfDeliveryFrom     | 2020-01-10 15:00:00          | Дата и время доставки (начало промежутка). Местное время по городу заказа                                                                                                   | No           |
| timeOfDeliveryTo       | 2020-01-10 19:00:00          | Дата и время доставки (конец промежутка). Местное время по городу заказа                                                                                                    | No           |
| deliveryDriverContacts | String                       | Контакты службы доставки (телефон водителя)                                                                                                                                 | No           |
| salesRepName           | String                       | Личный код продавца. Задается в ЛК Clicker (служит для учета продаж)                                                                                                        | No           |
| managers               | JSON Array                   | Массив емейлов сотрудников ритейлера, зарегистрированных в системе Clicker, которые будут назначены менеджерами данного заказа.                                             | No           |
| retailerDepartment     | String                       | Код подразделения продавца. Задается в ЛК Clicker.                                                                                                                          | No           |
| goodsToInstall         | JSON Array                   | Массив товаров, которые требуют установки. Нужен для того, чтобы мастер понимал, что будет устанавливать (см описание ниже)                                                 | No           |
| retailersOrderNumber   | String                       | Номер заказа в системе Ритейлера                                                                                                                                            | No           |
| legalEntity            | String                       | ИНН юридического лица, на которое будет оформлен заказ                                                                                                                      | No           |

### Описание структуры массива inсludedServicesCustom

| Name             | Тип     | Описание                                                                                                                                    | Обязательный |
| ---------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ------------ |
| title            | String  | Название услуги                                                                                                                             | Yes          |
| quantity         | Number  | Количество                                                                                                                                  | Yes          |
| price            | Number  | Цена                                                                                                                                        | Yes          |
| isPrepaid        | Boolean | true: клиент оплатил услугу при покупке товара false: услуга еще не оплачена. Оплата на месте наличными или по карте                        | Yes          |
| description      | String  | Краткое описание услуги                                                                                                                     | No           |
| includedWorks    | String  | Работы, входящие в стоимость. Это поле видит мастер и клиент. Можно использовать markdown разметку (ненумерованный список начинать с \*)    | No           |
| notIncludedWorks | String  | Работы, не входящие в стоимость. Это поле видит мастер и клиент. Можно использовать markdown разметку (ненумерованный список начинать с \*) | No           |

### Описание структуры массива includedServicesIds

| Name      | Тип     | Описание                                                                                                             | Обязательный |
| --------- | ------- | -------------------------------------------------------------------------------------------------------------------- | ------------ |
| serviceId | String  | id услуги в системе Clicker (можно посмотреть в личном кабинете)                                                     | Yes          |
| quantity  | Number  | Количество услуг                                                                                                     | Yes          |
| isPrepaid | Boolean | true: клиент оплатил услугу при покупке товара false: услуга еще не оплачена. Оплата на месте наличными или по карте | Yes          |
| discount  | Number  | Скидка на услугу                                                                                                     | No           |

### Описание структуры массива goodsToInstall

| Name       | Тип    | Описание                                                          | Обязательный |
| ---------- | ------ | ----------------------------------------------------------------- | ------------ |
| vendorCode | String | Актикул (обязательно должно быть уникальным в конкретном запросе) | Yes          |
| title      | String | Название товара                                                   | Yes          |
| quantity   | Number | Количество                                                        | Yes          |
| url        | String | Ссылка на карточку товара                                         | No           |
| price      | Number | Цена                                                              | No           |

### Города

| Name         | Тип             |
| ------------ | --------------- |
| Rostovnd     | Ростов-на-Дону  |
| Krasnodar    | Краснодар       |
| Volgograd    | Волгоград       |
| Samara       | Самара          |
| Tula         | Тула            |
| Moscow       | Москва          |
| Ekaterinburg | Екатеринбург    |
| StPetersburg | Санкт-Петербург |
| Lipetsk      | Липецк          |
| Ivanovo      | Иваново         |
| Kazan        | Казань          |
| Perm         | Пермь           |
| Tolyatti     | Тольятти        |
| Novosibirsk  | Новосибирск     |
| NNovgorod    | Нижний Новгород |

### Описание ответов систем

| HTTP код | Описание                                                                                      | Тело ответа                                                                                                                     |
| -------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| 200      | Заказ создан                                                                                  | { "status": "OK", "response": { "orderStatus": "created", "orderId": 7296 } }                                                   |
| 400      | Ошибка в парсинге структуры запроса. Пример: "Пустой запрос".                                 | { "status": "error", "response": { "message": "Invalid data sent", "details": "The request is empty" } }                        |
| 400      | Не найдены такие услуги в выбранном городе (если используется вариант includedServicesIds)    | { "status": "error", "response": { "message": "Invalid data sent", "details": "Invalid includedServicesIds" } }                 |
| 400      | Нет прав для использования кастомных услуг (если используется вариант includedServicesCustom) | { "status": "error", "response": { "message": "Invalid data sent", "details": "No permission to use includedServicesCustom" } } |
| 400      | Не пройдена авторизация                                                                       | { "status": "error", "response": { "message": "unable to authorize" } }                                                         |
| 400      | Переданы не все обязательные данные                                                           | { "status": "error", "response": { "message": "One of mandatory fields is missing" } }                                          |
| 500      | Внутренняя ошибка                                                                             | { "status": "error", "response": { "message": "Internal server error, "details": "Unexpected exception" } }                     |

<br>

# Изменение параметров в созданном заказе

1. API endpoint: https://api.clicker.one/v1/orders
2. API принимает PUT запросы от внешней системы. В запросе система ожидает получить заголовок: Content-Type: application/json.
3. Система отвечает HTTP кодом и JSON объектом.
4. В случае успешного запроса поле "status" в ответе будет иметь значение "OK". В противном случае - "error".

### Описание параметров тела запроса (JSON массив)

| Название               | Тип                 | Описание                                                                                                                                                                                                     | Обязательный |
| ---------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------ |
| shopId                 | String              | Идентификатор магазина в системе Clicker                                                                                                                                                                     | Yes          |
| apiKey                 | String              | API ключ клиента                                                                                                                                                                                             | Yes          |
| orderId                | String              | id заказа в системе Clicker. Можно узнать либо в личном кабинете, либо из ответа API на запрос создания заказа                                                                                               | Yes          |
| timeOfDeliveryFrom     | 2020-01-10 15:00:00 | Дата и время доставки (начало промежутка). Местное время по городу заказа. В случае изменения времени доставки оба поля должны быть заполнены. "Null" в случае отсутствующего/неизвестного времени доставки. | No           |
| timeOfDeliveryTo       | 2020-01-10 19:00:00 | Дата и время доставки (конец промежутка). Местное время по городу заказа. В случае изменения времени доставки оба поля должны быть заполнены. "Null" в случае отсутствующего/неизвестного времени доставки.  | No           |
| deliveryDriverContacts | String              | Контакты службы доставки (телефон водителя)                                                                                                                                                                  | No           |
| salesRepName           | String              | Личный код продавца. Задается в ЛК Clicker (служит для учета продаж)                                                                                                                                         | No           |
| retailerDepartment     | String              | Код подразделения продавца. Задается в ЛК Clicker.                                                                                                                                                           | No           |
| comment                | String              | Комментарий к заказу                                                                                                                                                                                         | No           |
| managers               | JSON Array          | Массив эмейлов сотрудников ритейлера, зарегистрированных в системе Кликер, которые будут назначены менеджерами данного заказа. Добавляются к уже существующим в заказе.                                      | No           |

### Описание ответов системы

| HTTP код | Описание                                                      | Тело ответа                                                                                                 |
| -------- | ------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 200      | Заказ обновлен                                                | { "status": "OK", "response": { "orderStatus": "updated" } }                                                |
| 400      | Ошибка в парсинге структуры запроса. Пример: "Пустой запрос". | { "status": "error", "response": { "message": "Invalid data sent", "details": "The request is empty" } }    |
| 404      | Не найден заказ                                               | { "status": "error", "response": { "message": "order not found" } }                                         |
| 400      | Не пройдена авторизация                                       | { "status": "error", "response": { "message": "unable to authorize" } }                                     |
| 500      | Внутренняя ошибка                                             | { "status": "error", "response": { "message": "Internal server error, "details": "Unexpected exception" } } |

<br>

# Получение информации о заказах

https://api.clicker.one/v1/orders?api_key=OSwiAWzMxaK9EDUL0BYDHFkZDYnjsinX&filter_by=createdDate&filter_value=["2021-10-28T06:30:00.000Z", "2021-10-30T12:00:00.000Z"]

1. API endpoint: https://api.clicker.one/v1/orders
2. API принимает GET запросы c параметрами от внешней системы и отвечает HTTP кодом и JSON объектом.
3. В случае успешного запроса поле "status" в ответе будет иметь значение "OK". В противном случае - "error".

### Описание параметров GET запроса

| Название         | Тип                    | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Обязательный | По-умолчанию | Пример значения                                                                                                              |
| ---------------- | ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| api_key          | String                 | API ключ клиента                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Yes          |              | xXxxxxXXxxxxxxxxxxxxxxxxxxxxxxxxx                                                                                            |
| filter_by        | String                 | Поле, по которому будет происходить фильтрация. Допустимые значения: timeOfVisit, timeOfDelivery, createdDate, orderId                                                                                                                                                                                                                                                                                                                                                       | Yes          |              | createdDate                                                                                                                  |
| filter_value     | String/Array of String | Значение, по которому будет происходить фильтрация. 1. Если фильтрация происходит по датам, представляет собой массив строк из двух дат (начало периода включительно, конец периода включительно) в формате ISO 8601. \*Если запрашивается дополнительная информация (services, history, comments, review, описание ниже), то интервал не должен быть более 24 часов. 2. Если фильтрация происходит по номеру заказа - представляет собой строку или массив с одной строкой. | Yes          |              | Фильтрация по датам: ["2020-07-28T06:30:00.000Z", "2020-09-30T12:00:00.000Z"] Фильтрация по номеру заказа: 5656 или ["5656"] |
| page             | Number                 | Атрибут пагинации: текущая страница для отображения.                                                                                                                                                                                                                                                                                                                                                                                                                         | No           | 1            | 2                                                                                                                            |
| size             | Number                 | Атрибут пагинации: количество заказов для отображения на одной странице в пределе 1-50 включительно.                                                                                                                                                                                                                                                                                                                                                                         | No           | 50           | 25                                                                                                                           |
| include_services | Boolean                | Нужно ли включить в ответ список услуг по заказу                                                                                                                                                                                                                                                                                                                                                                                                                             | No           | false        | true                                                                                                                         |
| include_history  | Boolean                | Нужно ли включить в ответ историю заказа                                                                                                                                                                                                                                                                                                                                                                                                                                     | No           | false        | true                                                                                                                         |
| include_comments | Boolean                | Нужно ли включить в ответ комментарии к заказу                                                                                                                                                                                                                                                                                                                                                                                                                               | No           | false        | true                                                                                                                         |
| include_review   | Boolean                | Нужно ли включить в ответ отзыв по заказу                                                                                                                                                                                                                                                                                                                                                                                                                                    | No           | false        | true                                                                                                                         |

### Описание ответа: контейнер

| Название | Тип    | Описание                                                                                                                               |
| -------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------- |
| status   | String | Статус ответа ("OK"/"error")                                                                                                           |
| response | Array  | Если статус "OK", то содержит массив заказов (описание ниже). Массив может быть пустым, если по указанным критериям ничего не найдено. |

### Описание ответа: заказ

| Название               | Тип                                                                                                                                                                                                                                                                                                                                                                | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| city                   | String                                                                                                                                                                                                                                                                                                                                                             | Город создания заказа. См. <a href="https://clicker.youtrack.cloud/articles/ISDEV-A-25/Instruktsiya-po-integratsii-vidzheta-Clicker#51-Goroda">список доступных городов</a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| orderId                | Number                                                                                                                                                                                                                                                                                                                                                             | id заказа в системе Clicker. Можно узнать либо в личном кабинете, либо из ответа API на запрос создания заказа                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| status                 | Enum ("waiting_for_consultation", "offered_for_consultation", "offered_for_assembly", "offered_for_call", "waiting_for_call", "consultation", "waiting", "cancelled", "blank", "received_review", "finished_unsuccessfully", "finished_successfully", "work_started", "serviceman_assigned", "service_company_assigned", "new_time_is_set", "new_time_is_not_set") | waiting_for_consultation: ждем консультации от монтажной компании; offered_for_consultation: поиск монтажной компании на консультацию; offered_for_assembly: поиск монтажной компании offered_for_call: поиск монтажной компании на прозвон; waiting_for_call: ждем звонка от монтажной компании; consultation: нужна консультация; waiting: в ожидании; cancelled: отменен; blank: пустой; received_review: получен отзыв; finished_unsuccessfully: завершен неуспешно; finished_successfully: завершен успешно; work_started: монтаж начат; serviceman_assigned: назначен монтажник; service_company_assigned: назначена монтажная компания; new_time_is_set: новый. время назначено; new_time_is_not_set: новый. время не назначено; |
| cancelReason           | Object                                                                                                                                                                                                                                                                                                                                                             | Если статус заказа CANCELLED, то данный объект содержит подробности отмены (описание ниже)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| clientsFullName        | String                                                                                                                                                                                                                                                                                                                                                             | ФИО клиента                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| createdDate            | Date                                                                                                                                                                                                                                                                                                                                                               | Дата создания заказа в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| clientsAddress         | String                                                                                                                                                                                                                                                                                                                                                             | Адрес доставки и оказания услуг                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| clientsPhone           | String                                                                                                                                                                                                                                                                                                                                                             | Мобильный телефон клиента без +7/8, а также без проблелов, дефисов, скобок и других разделителей, т.е. просто 10 цифр.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| comment                | String                                                                                                                                                                                                                                                                                                                                                             | Примечание к заказу                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| timeOfVisitFrom        | Date                                                                                                                                                                                                                                                                                                                                                               | Дата и время визита мастера (начало промежутка) в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| timeOfVisitTo          | Date                                                                                                                                                                                                                                                                                                                                                               | Дата и время визита мастера (конец промежутка) в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| timeOfDeliveryFrom     | Date                                                                                                                                                                                                                                                                                                                                                               | Дата и время доставки (начало промежутка) в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| timeOfDeliveryTo       | Date                                                                                                                                                                                                                                                                                                                                                               | Дата и время доставки (конец промежутка) в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| deliveryDriverContacts | String                                                                                                                                                                                                                                                                                                                                                             | Контакты службы доставки (телефон водителя)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| retailersOrderNumber   | String                                                                                                                                                                                                                                                                                                                                                             | Номер заказа в системе Ритейлера                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| orderUrl               | String                                                                                                                                                                                                                                                                                                                                                             | Ссылка заказа для перехода в личный кабинет на i.clicker.one                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| review                 | String                                                                                                                                                                                                                                                                                                                                                             | Текст отзыва по заказу. Только если в запросе присутствует include_review                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| rating                 | Number                                                                                                                                                                                                                                                                                                                                                             | Оценка заказа, целое число от 1 до 5. Только если в запросе присутствует include_review                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| comments               | Array                                                                                                                                                                                                                                                                                                                                                              | Массив с комментариями по заказу (описание ниже). Только если в запросе присутствует include_comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| history                | Array                                                                                                                                                                                                                                                                                                                                                              | Массив с записями истории заказа (описание ниже). Только если в запросе присутствует include_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| services               | Array                                                                                                                                                                                                                                                                                                                                                              | Массив с услугами по заказу (описание ниже). Только если в запросе присутствует include_services                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| salesman               | Object                                                                                                                                                                                                                                                                                                                                                             | Данные продавца (описание полей ниже).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| serviceCompany         | Object                                                                                                                                                                                                                                                                                                                                                             | Данные монтажной компании (описание полей ниже)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

### Описание ответа: услуга (массив services)

| Название                     | Тип     | Описание                                                                                                      |
| ---------------------------- | ------- | ------------------------------------------------------------------------------------------------------------- |
| title                        | String  | Название услуги                                                                                               |
| description                  | String  | Описание услуги                                                                                               |
| includedWorks                | String  | Перечень того, что входит в услугу                                                                            |
| notIncludedWorks             | String  | Перечень того, что НЕ входит в услугу                                                                         |
| quantity                     | Number  | Количество                                                                                                    |
| isPaid                       | Boolean | true: услуга на данный момент оплачена; false: услуга еще не оплачена. Оплата на месте наличными или по карте |
| paidAtRetailer               | Number  | Оплачено у ритейлера (руб.)                                                                                   |
| paidByCard                   | Number  | Оплачено по карте по ссылке Clicker (руб.)                                                                    |
| paidWithCash                 | Number  | Оплачено наличными на месте (руб.)                                                                            |
| price                        | Number  | Цена одной единицы услуги (руб.)                                                                              |
| total                        | Number  | Стоимость услуги, умноженная на количество услуг (руб.)                                                       |
| retailerCommissionPerService | Number  | Комиссия ритейлера за одну единицу услуги (руб.)                                                              |
| retailerCommissionTotal      | Number  | Комиссия ритейлера за одну единицу услуги, умноженная на количество услуг (руб.)                              |
| clickerCommissionPerService  | Number  | Комиссия Clicker за одну единицу услуги (руб.)                                                                |
| clickerCommissionTotal       | Number  | Комиссия Clicker за одну единицу услуги, умноженная на количество услуг (руб.)                                |
| mcPricePerService            | Number  | Вознаграждение монтажной компании за одну единицу услуги (руб.)                                               |
| mcPriceTotal                 | Number  | Вознаграждение монтажной компании за одну единицу услуги, умноженное на количество услуг (руб.)               |
| uniqueId                     | String  | Уникальный id записи                                                                                          |
| serviceCatalogId             | String  | id услуги из справочника. Если услуга не из справочника, а индивидуальная, то поле пустое.                    |

### Описание ответа: история (массив history)

| Название    | Тип    | Описание                                                                        |
| ----------- | ------ | ------------------------------------------------------------------------------- |
| text        | String | Текст произошедшего события                                                     |
| author      | String | Имя пользователя, создавшего событие                                            |
| createdDate | Date   | Дата и время события в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00 |
| uniqueId    | String | Уникальный id записи                                                            |

### Описание ответа: комментарий (массив comments)

| Название    | Тип    | Описание                                                                                     |
| ----------- | ------ | -------------------------------------------------------------------------------------------- |
| text        | String | Текст комментария                                                                            |
| file        | String | Ссылка на файл (если прикреплен)                                                             |
| author      | String | Имя пользователя, оставившего комментарий                                                    |
| createdDate | Date   | Дата и время создания комментарий в формате https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00 |
| uniqueId    | String | Уникальный id записи                                                                         |

### Описание ответа: монтажная компания (объект serviceCompany)

| Название | Тип    | Описание             |
| -------- | ------ | -------------------- |
| uniqueId | String | Уникальный id записи |

### Описание ответа: продавец (объект salesman)

| Название | Тип    | Описание     |
| -------- | ------ | ------------ |
| uniqueId | String | Код продавца |
| name     | String | Имя продавца |

### Описание ответа: причина отмены (объект cancelReason)

| Название | Тип    | Описание                           |
| -------- | ------ | ---------------------------------- |
| text     | String | Описание причины отмены на русском |
| comment  | String | Комментарий к отмене               |

## Примеры запросов

1. Фильтрация с использованием промежутка дат.

   **GET** *https://api.clicker.one/v1/orders?api_key=xXxxxxXXxxxxxxxxxxxxxxxxxxxxxxxxx&filter_by=createdDate&filter_value=["2020-07-28T06:30:00.000Z", "2020-09-30T12:00:00.000Z"]&page=2&size=50*

2. Фильтрация по номеру заказа.

   **GET** *https://api.clicker.one/v1/orders?api_key=xXxxxxXXxxxxxxxxxxxxxxxxxxxxxxxxx&filter_by=orderId&filter_value=5656*

### Описание ответов системы

| HTTP код | Описание                                                                           | Тело ответа                                                                                                                              |
| -------- | ---------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| 200      | Заказы найдены                                                                     | { "status": "OK", "paging": { "currentPage": 3, "totalPages": 5, "pageSize": "100" }, "response":[ { <Данные заказа> }, .... ] }         |
| 200      | Заказы с текущими фильтрами не найдены                                             | { "status": "OK", "response": [] }                                                                                                       |
| 400      | Ошибка в парсинге структуры запроса. Пример: "некорректный параметр filter_value". | { "status": "error", "response": { "message": "Invalid data sent", "details": "Parameter filter_value is missing or can't be parsed" } } |
| 400      | Не пройдена авторизация                                                            | { "status": "error", "response": { "message": "unable to authorize" } }                                                                  |
| 500      | Внутренняя ошибка                                                                  | { "status": "error", "response": { "message": "Internal server error, "details": "Unexpected exception" } }                              |

<br>

# Получение информации из справочника услуг

1. API endpoint: *https://api.clicker.one/v1/prices*
2. API принимает GET запросы c параметрами от внешней системы и отвечает HTTP кодом и JSON объектом.
3. В случае успешного запроса поле "status" в ответе будет иметь значение "OK". В противном случае - "error".

### Описание параметров GET запроса

| Название | Тип    | Описание                                             | Обязательный | По-умолчанию | Пример значения                   |
| -------- | ------ | ---------------------------------------------------- | ------------ | ------------ | --------------------------------- |
| shopId   | String | Идентификатор магазина в системе Clicker             | Yes          |              |                                   |
| api_key  | String | API ключ клиента                                     | Yes          |              | xXxxxxXXxxxxxxxxxxxxxxxxxxxxxxxxx |
| page     | Number | Атрибут пагинации: текущая страница для отображения. | No           | 1            | 2                                 |

### Описание ответа: контейнер

| Название    | Тип    | Описание                                                                                                                               |
| ----------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------- |
| status      | String | Статус ответа ("OK"/"error")                                                                                                           |
| response    | Array  | Если статус "OK", то содержит массив услуг (описание ниже). Максимальное количество записей в одном ответе зависит от параметра limit. |
| paging      | Object | Объект пагинации, содержит информацию о текущей странице. Свойства описаны ниже                                                        |
| currentPage | Number | Номер текущей страницы                                                                                                                 |
| totalPages  | Number | Всего страниц                                                                                                                          |
| pageSize    | Number | Максимальное количество записей в ответе. Задаётся в запросе параметром limit. По умолчанию равен 100.                                 |

### Описание ответа: услуга

| Название            | Тип    | Описание                                                                                                                                                                                                                                   |
| ------------------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| city                | String | Город                                                                                                                                                                                                                                      |
| clientPrice         | Number | Цена для клиента (руб.)                                                                                                                                                                                                                    |
| retailerCommission  | Number | Комиссия Ритейлера (руб.)                                                                                                                                                                                                                  |
| mcPrice             | Number | Вознаграждение монтажной компании (руб.)                                                                                                                                                                                                   |
| clickerCommission   | Number | Комиссия Clicker (руб.)                                                                                                                                                                                                                    |
| serviceCatalogId    | String | Уникальный id услуги из справочника. Обратите внимание, это не уникальный id записи, а именно id услуги. То есть например одна и та же услуга в разных городах будет давать несколько разных записей с разными ценами, но с одинаковыми id |
| serviceTitle        | String | Название услуги                                                                                                                                                                                                                            |
| serviceDescription  | String | Описание услуги                                                                                                                                                                                                                            |
| serviceInclude      | String | Перечень того, что входит в услугу                                                                                                                                                                                                         |
| serviceNotInclude   | String | Перечень того, что НЕ входит в услугу                                                                                                                                                                                                      |
| serviceCategoryId   | String | ID категории, которой принадлежит услуга                                                                                                                                                                                                   |
| serviceCategoryName | String | Название категории, которой принадлежит услуга                                                                                                                                                                                             |

## Примеры запросов

1. **GET** *https://api.clicker.one/v1/prices?api_key=xXxxxxXXxxxxxxxxxxxxxxxxxxxxxxxxx&page=2&limit=20*

### Описание ответов системы

| HTTP код | Описание                                                                | Тело ответа                                                                                                             |
| -------- | ----------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| 200      | Услуги найдены                                                          | { "status": "OK", "response": [<Результаты запроса>], "paging": { "currentPage": 3, "totalPages": 3, "pageSize": 20 } } |
| 400      | Ошибка в парсинге структуры запроса. Не переданы обязательные параметры | { "status": "error", "response": { "message": "Invalid data sent", "details": "Parameters are required" } }             |
| 400      | Не пройдена авторизация                                                 | { "status": "error", "response": { "message": "Invalid data sent", "details": "Unable to authorize" } }                 |
| 500      | Внутренняя ошибка                                                       | { "status": "error", "response": { "message": "Internal server error, "details": "Unexpected exception" } }             |

<br>

# Получение информации о подразделениях ритейлера

1. API endpoint: *https://api.clicker.one/v1/departments*
2. API принимает GET запросы c параметрами от внешней системы и отвечает HTTP кодом и JSON объектом.
3. В случае успешного запроса поле "status" в ответе будет иметь значение "OK". В противном случае - "error".

## Пример запроса

https://api.clicker.one/v1/departments?api_key=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

### Описание GET параметров

| Название | Тип    | Описание         | Обязательный | Пример значения                   |
| -------- | ------ | ---------------- | ------------ | --------------------------------- |
| api_key  | String | API ключ клиента | Yes          | xXxxxxXXxxxxxxxxxxxxxxxxxxxxxxxxx |

## Пример ответа

```json
{
  "status": "OK",
  "response": [
    {
      "code": "01",
      "name": "Центральный офис",
      "cities": ["Volgograd", "Ekaterinburg"]
    },
    {
      "code": "02",
      "name": "Другое",
      "cities": ["Volgograd", "Ekaterinburg"]
    }
  ],
  "paging": {
    "currentPage": 1,
    "totalPages": 1,
    "pageSize": 2
  }
}
```

### Описание ответа: контейнер

| Название | Тип    | Описание                                                            |
| -------- | ------ | ------------------------------------------------------------------- |
| status   | String | Статус ответа ("OK"/"error")                                        |
| response | Array  | Если статус "OK", то содержит массив подразделений (описание ниже). |

### Описание ответа: подразделение

| Название | Тип      | Описание                                    |
| -------- | -------- | ------------------------------------------- |
| code     | String   | Код подразделения                           |
| name     | String   | Название подразделения                      |
| cities   | String[] | Массив городов подразделения, на английском |

<br>

# Подписка на изменения в заказах [в разработке]

- Отправляет на указанный адрес пакет с JSON массивом с изменениями по заказам.
- Каждый объект в массиве содержит информацию либо о самом заказе, либо о другой сущности, имеющей к нему отношение (комментарий, отзыв, услуга, изменение истории)
- Объект содержит полную информацию о сущности, независимо от того, что именно в ней изменилось.
- Максимальное количество объектов в одном пакете: 10
- Объекты в массиве отсортированы по дате изменения, однако при большом количестве единовременных изменений отправляется несколько пакетов, по 10 изменений в каждом, которые могут могут дойти не в правильной последовательности, поэтому всегда рекомендуется сверять дату изменения.

### Описание: контейнер пакета

| Название  | Тип   | Описание                                                                                     |
| --------- | ----- | -------------------------------------------------------------------------------------------- |
| updates   | Array | Содержит массив объектов с изменениями (описание ниже)                                       |
| firstDate | Date  | Дата и время первого изменения в массиве https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00    |
| lastDate  | Date  | Дата и время последнего изменения в массиве https://en.wikipedia.org/wiki/ISO_8601 UTC±00:00 |

### Описание: контейнер сообщения об изменении

| Название     | Тип                                                       | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ------------ | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| entityDate   | Data                                                      | Дата изменений (создания, изменения или удаления)                                                                                                                                                                                                                                                                                                                                                                                                                         |
| entityStatus | Enum ("created", "updated", "deleted")                    | Тип изменения                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| entityType   | Enum ("order", "comment", "history", "review", "service") | Тип сущности                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| entityId     | String                                                    | Внутренний id сущности                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| entity       | Object                                                    | Данные сущности, подвергшейся изменениям. Данные совпадают с описанными в основном методе получения данных о заказе https://www.notion.so/API-Clicker-919e9571598b4e4d8504a05a09138848 Кроме двух полей: внутренний id сущности и дата сущности, здесь они вынесены в контейнер (entityId и entityDate). Также добавлено поле parentId, которое содержит entityId заказа, к которому данная сущность относится (соответственно, за исключением обновлений самого заказа). |

### Пример пакета

```json
{
  "firstDate": "2021-02-05T08:18:49.575Z",
  "lastDate": "2021-02-05T08:18:49.575Z",
  "updates": [
    {
      "entityType": "history",
      "entityId": "1612513129369x383789816993546200",
      "entityStatus": "created",
      "entityDate": "2021-02-05T08:18:49.575Z",
      "entity": {
        "parentId": "1612336146141x924204214215508000",
        "text": "Отзыв (Оценка: 5)",
        "author": "Алексей"
      }
    }
  ]
}
```

<br>

# Получение списка доступных услуг для города [в разработке]

Метод возвращает список доступных услуг для конкретного города. Используется, если вы самостоятельно хотите отображать модуль выбора услуг.

1. API endpoint: **https://api.clicker.one/v1/services**
2. API принимает GET запросы от внешней системы. В запросе система ожидает получить параметры адресной строки
3. Система отвечает HTTP кодом и JSON объектом.

**Формат параметров адресной строки:**

```ts
{
  shopId: string;
  city: string;
  lon?: number;
  lat?: number;
}
```

**shopId** [обязательно] - идентификатор магазина в системе Clicker

**city** [обязательно должен быть либо city, либо lon & lat] - Город, см. <a href="https://clicker.youtrack.cloud/articles/ISDEV-A-25/Instruktsiya-po-integratsii-vidzheta-Clicker#51-Goroda">список доступных городов</a>

**lon** [в разработке] [обязательно должен быть либо city, либо lon & lat] - примерная долгота географической точки предполагаемой установки услуги

**lat** [в разработке] [обязательно должен быть либо city, либо lon & lat] - примерная широта географической точки предполагаемой установки услуги

**Пример body запроса:**

```text
GET https://api.clicker.one/v1/services?shopId=superShop&city=Moscow
```

## Ответ

Ответ приходит в формате Content-Type: application/json.

**Формат body ответа:**

```ts
{
  status: "OK";
  services: Array<{
    id: string;
    name: string;
    description?: string;
    includedWorks?: string[];
    notIncludedWorks?: string[];
    price: number;
  }>;
}
```

**services** - массив найденных подходящих услуг. Услуга состоит из:

**id** - id услуги. Будет необходим при создании заказа

**name** - название услуги

**description** [опциональный] - описание услуги, если есть

**includedWorks** [опциональный] - массив строк, работы, которые включены в стоимость

**notIncludedWorks** [опциональный] - массив строк, работы, которые не включены в стоимость

**price** - цена для покупателя

**Пример body ответа:**

```json
{
	"status": "OK",
  "services": [
    {
      "id": "1586179958241xxx8539406150374410",
      "name": "Установка электрического духового шкафа",
      "description": "Встроим электрический духовой шкаф в подготовленное место и подключим к электрике",
      "includedWorks": [
          "Выезд специалиста в пределах границы города (для г. Москва выезд в пределах МКАД)",
          "Распаковка и визуальный осмотр техники",
          "Проверка готовности к подключению имеющейся у заказчика силовой линии",
          "Устройство отверстия в мебельных перегородках для прокладки коммуникаций",
          "Установка электрической вилки",
          "Установка техники в мебель, на подготовленное место и выравнивание по уровню",
          "Проверка работоспособности",
          "Очистка рабочей зоны и уборка мусора",
          "Демонстрация работы и объяснение основных функций"
      ],
      "notIncludedWorks": [
          "Демонтаж старой техники",
          "Материалы для подключения, помимо входящих в комплект поставки",
          "Перенос розеток",
          "Удлинение шнуров питания",
          "Доработка мебели или рабочих поверхностей",
          "Выезд за границу города",
          "Утилизация упаковки"
      ],
      "price": 1700
    },
		{
			...
		}
  ]
}
```

<br>

# Получение списка доступных услуг для товара [в разработке]

Метод возвращает список доступных услуг для конкретного товара или массива товаров. Используется, если вы самостоятельно хотите отображать модуль выбора услуг в карточке товара и в корзине магазина.

1. API endpoint: **https://api.clicker.one/v1/services/match**
2. API принимает POST запросы от внешней системы. В запросе система ожидает получить Content-Type: application/json.
3. Система отвечает HTTP кодом и JSON объектом.

**Формат body запроса:**

```ts
{
  shopId: string;
  city: string;
  geoPosition?: { lon: number; lat: number }
  cart: Array<{
    productId: string;
    matchProperties: Array<{ key: string; value: any }>;
  }>;
}
```

**shopId** [обязательно] - идентификатор магазина в системе Clicker

**city** [обязательно должен быть либо city, либо geoPosition] - Город, см. <a href="https://clicker.youtrack.cloud/articles/ISDEV-A-25/Instruktsiya-po-integratsii-vidzheta-Clicker#51-Goroda">список доступных городов</a>

**geoPosition** [в разработке] [обязательно должен быть либо city, либо geoPosition] - примерная широта и долгота географической точки предполагаемой установки услуги

**cart** [обязательно] - массив ваших товаров, для которых требуется подобрать услуги

**productId** [обязательно] - уникальный идентификатор вашего товара. К нему в ответе будут привязаны услуги

**matchProperties** [обязательно] - массив, набор параметров, по которым будет происходить поиск подходящей услуги, <a href="https://clicker.youtrack.cloud/articles/ISDEV-A-25/Instruktsiya-po-integratsii-vidzheta-Clicker#4-Pravila-sopostavleniya-tovar-usluga">подробнее о сопоставлении</a>. Экземпляр массива состоит из:

**key** [обязательно] - название ключа параметра, по которому будет происходить сопоставление товар/услуга

**value** - значение параметра

**Пример body запроса:**

```json
{
  "city": "Moscow",
  "shopId": "super_shop",
  "cart": [
    {
      "productId": "ID4354646_tv321",
      "matchProperties": [
        {
          "key": "title",
          "value": "Телевизор LG 2124"
        }
      ]
    },
    {
      "productId": "ID43434222_THERMEX_Praktik",
      "matchProperties": [
        {
          "key": "title",
          "value": "Водонагреватель аккумуляционный электрический THERMEX Praktik 80 V"
        },
        {
          "key": "category",
          "value": "Водонагреватели"
        },
        {
          "key": "Объем (литров)",
          "value": 80
        }
      ]
    }
  ]
}
```

## Ответ

Ответ приходит в формате Content-Type: application/json.

Формат ответа идентичен <a href="#Otvet">ответу всех услуг города</a>, за исключением того, что к каждой услуге добавляется параметр productId - уникальный идентификатор вашего товара, переданный в запросе, т.е. данная услуга будет относиться к этому товару. К одному productId помет прийти только одна услуга.

<br>

# 🕙 История версий

<details> 
  	<summary>1.21, 41.10.2022</summary> 
  	- Получение списка доступных услуг для товара [в разработке]
  </details>

<details> 
  	<summary>1.20, 13.12.2021</summary> 
  	- Salesman в ответе get orders
  </details>

<details> 
  	<summary>1.19, 18.11.2021</summary> 
  	- При получении данных по заказам в объекте услуги название параметра isPrepaid изменено на isPaid 
  </details>

<details> 
  	<summary>1.18, 09.11.2021</summary> 
  	- Добавлен метод получения списка доступных услуг для товара 
  </details>

<details> 
  	<summary>1.17, 14.10.2021</summary> 
  	- В создание и обновление заказа добавлено поле managers
  </details>

<details> 
  	<summary>1.16, 15.09.2021</summary> 
  	- В получение данных по заказам добавлена информация о монтажной компании
  </details>

<details> 
  	<summary>1.15, 28.04.2021</summary> 
  	- Добавлены новые города 
  </details>

<details> 
  	<summary>1.14, 20.04.2021</summary> 
  	- В api создания заказа добавлено юр. лицо
  </details>

 <details> 
  	<summary>1.13, 08.04.2021</summary> 
  	- В ответ api Получение информации из справочника услуг добавлены поля serviceCategoryId, serviceCategoryName<br>
  	- Там же убрано ограничение на лимит записей в ответе
  </details>
